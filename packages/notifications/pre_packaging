#! bin/bash
set -e -x

function tag_release() {
  echo > .gitmodules
  echo "[submodule \"src/notifications\"]" >> .gitmodules
  echo "  path = src/notifications" >> .gitmodules
  echo "  url = git@github.com:cloudfoundry-incubator/notifications.git" >> .gitmodules

  cp -r ./git ./.git

  mkdir src
  ln -s src/notifications ./notifications

  git submodule status | awk '{ print $1 }' | sed "s/[-+]//g" > notifications/.gitsha

  rm -rf ./.git
}

tag_release
